<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Supernova Squad - NASA Space Biology Knowledge Engine</title>
  <meta name="description" content="Dynamic AI-powered dashboard for exploring 608 NASA bioscience publications and 500+ space biology experiments">
  <link href="home.css" rel="stylesheet">
  <style>
    html, body { height: 100%; margin: 0; }
    body { 
      background: #000; 
      color: #fff; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    }
    canvas { 
      display: block; 
      position: fixed; 
      inset: 0; 
      width: 100%; 
      height: 100%; 
      z-index: -1; 
    }
    
    /* Enhanced stats section */
    .stats-banner {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
      padding: 1.5rem;
      background: rgba(99, 102, 241, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(99, 102, 241, 0.2);
    }
    
    .stat-item {
      text-align: center;
      padding: 1rem;
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, #6366f1, #06b6d4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .stat-label {
      color: #94a3b8;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    /* Mission info badge */
    .mission-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1));
      border-radius: 20px;
      border: 1px solid rgba(99, 102, 241, 0.3);
      font-size: 0.85rem;
      margin-bottom: 1rem;
    }
    
    .mission-badge svg {
      width: 16px;
      height: 16px;
    }
    
    /* Filter panel */
    .filter-panel {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .filter-group label {
      display: block;
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }
    
    .filter-group select {
      width: 100%;
      padding: 0.5rem;
      background: rgba(99, 102, 241, 0.05);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 0.9rem;
    }
    
    /* Export options */
    .export-dropdown {
      position: relative;
      display: inline-block;
    }
    
    .export-menu {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 0.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      min-width: 180px;
      box-shadow: var(--shadow-xl);
      z-index: 100;
    }
    
    .export-menu.show {
      display: block;
    }
    
    .export-menu button {
      width: 100%;
      text-align: left;
      padding: 0.75rem 1rem;
      background: transparent;
      border: none;
      color: var(--text-primary);
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s;
    }
    
    .export-menu button:hover {
      background: rgba(99, 102, 241, 0.1);
    }
    
    /* Enhanced source cards */
    .source-tag {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      background: rgba(99, 102, 241, 0.2);
      border-radius: 12px;
      font-size: 0.75rem;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    /* Loading states */
    .skeleton {
      background: linear-gradient(90deg, rgba(99, 102, 241, 0.1) 25%, rgba(99, 102, 241, 0.2) 50%, rgba(99, 102, 241, 0.1) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 8px;
      height: 100px;
    }
    
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* Citation preview */
    .citation-preview {
      background: rgba(6, 182, 212, 0.1);
      border-left: 3px solid #06b6d4;
      padding: 0.75rem;
      margin-top: 0.5rem;
      border-radius: 4px;
      font-size: 0.85rem;
      font-style: italic;
    }
  </style>
</head>
<body>
  <canvas id="starfield" aria-hidden="true"></canvas>

  <div class="container">
    <!-- Header with mission info -->
    <header class="header">
      <a href="interface.html"> <img src="logo.png" alt="SuperNova Squad Logo" class="logo" ></a>
      <div class="brand-info" style="flex: 1;">
        <div class="mission-badge">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
          </svg>
          NASA Space Apps Challenge 2025
        </div>
        <h1>SuperNova Squad</h1>
        <p>Space Biology Knowledge Engine • 608 Publications • 500+ Experiments</p>
      </div>
      <div class="auth-section">
        <div id="auth-buttons" class="auth-buttons">
          <button id="login-btn" class="auth-btn" type="button">Login</button>
          <button id="register-btn" class="auth-btn primary" type="button">Register</button>
        </div>
        <div id="user-info" class="user-info" style="display: none;">
          <span id="username-display"></span>
          <button id="history-btn" class="auth-btn" type="button">History</button>
          <button id="logout-btn" class="auth-btn" type="button">Logout</button>
        </div>
      </div>
    </header>



    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-header">
        <div class="hero-content">
          <h2>Space Biology Knowledge Engine</h2>
          <p>AI-powered exploration of decades of NASA bioscience research</p>
        </div>
        <button class="toggle-models-btn" id="toggle-models-btn" 
                aria-label="Toggle agent selection" type="button" aria-expanded="false">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" 
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 5v14M5 12h14"/>
          </svg>
        </button>
      </div>

      <!-- Agent Selector -->
      <div class="model-selector" id="model-selector" style="display: none;">
        <button class="model-btn" data-model="researcher" type="button" aria-pressed="false">
          <div>🔬 Researcher Mode</div>
          <div class="model-desc">608 publications + 500 OSDR experiments • Technical analysis</div>
        </button>
        <button class="model-btn" data-model="student" type="button" aria-pressed="false">
          <div>📚 Student Mode</div>
          <div class="model-desc">All content + astrophysics books • Simple explanations</div>
        </button>
        <button class="model-btn" data-model="manager" type="button" aria-pressed="false">
          <div>📊 Manager Mode</div>
          <div class="model-desc">Research + space economy • Executive insights</div>
        </button>
      </div>

      <!-- Search with filters -->
      <div class="search-container">
        <div class="filter-panel" id="filter-panel" style="display: none;">
          <h4 style="margin-bottom: 0.5rem;">Advanced Filters</h4>
          <div class="filter-grid">
            <div class="filter-group">
              <label for="year-filter">Publication Year</label>
              <select id="year-filter">
                <option value="">All Years</option>
                <option value="2020-2025">2020-2025</option>
                <option value="2015-2019">2015-2019</option>
                <option value="2010-2014">2010-2014</option>
                <option value="before-2010">Before 2010</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="topic-filter">Research Topic</label>
              <select id="topic-filter">
                <option value="">All Topics</option>
                <option value="microgravity">Microgravity Effects</option>
                <option value="plant">Plant Biology</option>
                <option value="human">Human Health</option>
                <option value="microbial">Microbial Research</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="mission-filter">Mission Context</label>
              <select id="mission-filter">
                <option value="">All Missions</option>
                <option value="iss">ISS Research</option>
                <option value="moon">Lunar Missions</option>
                <option value="mars">Mars Missions</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="search-box">
          <input type="search" class="search-input" id="search-input"
                 placeholder="e.g., How does microgravity affect yeast gene expression?"
                 aria-label="Search research papers">
          <button class="btn" id="filter-toggle" type="button" 
                  aria-label="Toggle filters" style="padding: 0.75rem;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" 
                 stroke="currentColor" stroke-width="2">
              <path d="M3 6h18M7 12h10M11 18h2"/>
            </svg>
          </button>
          <button class="search-btn" id="search-btn" type="button">
            <span id="search-text">Send</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" 
                 stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      </div>
    </section>

    <!-- Results Grid -->
    <div class="results-grid">
      <!-- Chat History Card -->
      <div class="card" id="chat-card" style="display:none;" aria-hidden="true">
        <div class="card-header">
          <h3>Research Conversation</h3>
          <div class="card-actions">
            <button class="btn" id="show-full-history-btn" type="button">Show Full History</button>
            <button class="btn" id="copy-conversation-btn" type="button">Copy All</button>
            <div class="export-dropdown">
              <button class="btn" id="export-btn" type="button">Export ▼</button>
              <div class="export-menu" id="export-menu">
                <button data-format="bibtex">BibTeX Format</button>
                <button data-format="ris">RIS Format</button>
                <button data-format="json">JSON Data</button>
                <button data-format="csv">CSV Report</button>
              </div>
            </div>
            <button class="btn" id="clear-conversation-btn" type="button">Clear Chat</button>
          </div>
        </div>
        <div id="chat-history" class="chat-history" tabindex="-1">
          <div class="empty-state">Talk to Nova-AI. your loyal bioscience assitant</div>
        </div>
      </div>

      <!-- Sources Card -->
      <div class="card" id="sources-card" style="display:none;" aria-hidden="true">
        <div class="card-header">
          <h3>Research Sources</h3>
          <button class="btn" id="view-knowledge-graph" type="button">📊 View Graph</button>
        </div>
        
        <div class="sources-search-container">
          <div class="sources-search-box">
            <input type="search" class="sources-search-input" 
                   id="sources-search-input"
                   placeholder="Search by paper title, author, or DOI..."
                   aria-label="Search research papers">
            <div class="search-suggestions" id="sources-suggestions" style="display:none;"></div>
            <button class="btn btn-primary" id="sources-search-btn" type="button">Send message</button>
            <button class="btn" id="summarize-paper-btn" type="button">Summarize</button>
          </div>
        </div>
        
        <div class="sources-list" id="sources-list" aria-live="polite">
          <div class="empty-state">Sources will appear here after searching</div>
        </div>
      </div>

      <!-- Quiz Card -->
      <div class="card" id="quiz-card" style="display:none;" aria-hidden="true">
        <div class="card-header">
          <h3>Research Paper Quiz</h3>
          <div class="card-actions">
            <button class="btn" id="show-quiz-answers-btn" type="button" style="display:none;">Show Answers</button>
            <button class="btn" id="clear-quiz-btn" type="button">Clear Quiz</button>
          </div>
        </div>
        
        <div class="quiz-search-container">
          <div class="quiz-search-box">
            <input type="search" class="quiz-search-input" 
                   id="quiz-search-input"
                   placeholder="Search by paper title, author, or DOI..."
                   aria-label="Search research papers for quiz">
            <div class="search-suggestions" id="quiz-suggestions" style="display:none;"></div>
            <button class="btn btn-primary" id="quiz-search-btn" type="button">Search</button>
            <button class="btn" id="generate-quiz-btn" type="button">Generate Quiz</button>
          </div>
        </div>
        
        <div class="quiz-content" id="quiz-content" aria-live="polite">
          <div class="empty-state">Search for a paper and generate a quiz to test your knowledge</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals (login, register, history, summary) -->
  <div class="modal" id="summary-modal" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h2>Paper Summary</h2>
        <button class="close-btn" id="close-modal" type="button">&times;</button>
      </div>
      <div class="modal-body" id="modal-body" tabindex="0"></div>
      <div class="modal-footer">
        <button class="btn" id="copy-summary-btn" type="button">Copy</button>
        <button class="btn btn-primary" id="close-modal-2" type="button">Close</button>
      </div>
    </div>
  </div>

  <!-- Enhanced Login Modal -->
  <div class="modal" id="login-modal" hidden>
    <div class="modal-content auth-modal">
      <div class="modal-header auth-header">
        <div>
          <div class="auth-icon">🔐</div>
          <h2>Welcome Back</h2>
          <p class="auth-subtitle">Sign in to continue your research journey</p>
        </div>
        <button class="close-btn" id="close-login-modal" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <form id="login-form" class="auth-form">
          <div class="form-group enhanced">
            <label for="login-username">Username</label>
            <div class="input-wrapper">
              <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
              <input type="text" id="login-username" name="username" placeholder="Enter your username" required>
            </div>
          </div>
          <div class="form-group enhanced">
            <label for="login-password">Password</label>
            <div class="input-wrapper">
              <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
              <input type="password" id="login-password" name="password" placeholder="Enter your password" required>
            </div>
          </div>
          <div id="login-error" class="error-message enhanced" style="display: none;"></div>
          <div class="modal-footer auth-footer">
            <button type="submit" class="btn btn-primary full-width">
              <span>Sign In</span>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </button>
            <button class="btn btn-secondary full-width" id="close-login-modal-2" type="button">Cancel</button>
          </div>
        </form>
        <div class="auth-divider">
          <span>Don't have an account?</span>
        </div>
        <button class="btn btn-link" onclick="document.getElementById('close-login-modal').click(); document.getElementById('register-btn').click();" type="button">
          Create new account
        </button>
      </div>
    </div>
  </div>

  <!-- Enhanced Register Modal -->
  <div class="modal" id="register-modal" hidden>
    <div class="modal-content auth-modal">
      <div class="modal-header auth-header">
        <div>
          <div class="auth-icon">🚀</div>
          <h2>Join SuperNova</h2>
          <p class="auth-subtitle">Start exploring NASA space biology research</p>
        </div>
        <button class="close-btn" id="close-register-modal" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <form id="register-form" class="auth-form">
          <div class="form-group enhanced">
            <label for="register-username">Username</label>
            <div class="input-wrapper">
              <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
              <input type="text" id="register-username" name="username" placeholder="Choose a username" required>
            </div>
          </div>
          <div class="form-group enhanced">
            <label for="register-email">Email</label>
            <div class="input-wrapper">
              <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="4" y="4" width="16" height="16" rx="2" ry="2"/>
                <path d="M4 4l8 8 8-8"/>
              </svg>
              <input type="email" id="register-email" name="email" placeholder="Enter your email" required>
            </div>
          </div>
          <div class="form-group enhanced">
            <label for="register-password">Password</label>
            <div class="input-wrapper">
              <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
              <input type="password" id="register-password" name="password" 
                     minlength="8" placeholder="Create a password (8+ characters)" required>
            </div>
          </div>
          <div class="form-group enhanced">
            <label for="register-confirm-password">Confirm Password</label>
            <div class="input-wrapper">
              <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
              </svg>
              <input type="password" id="register-confirm-password" 
                     name="confirm-password" placeholder="Confirm your password" required>
            </div>
          </div>
          <div id="register-error" class="error-message enhanced" style="display: none;"></div>
          <div class="modal-footer auth-footer">
            <button type="submit" class="btn btn-primary full-width">
              <span>Create Account</span>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </button>
            <button class="btn btn-secondary full-width" id="close-register-modal-2" type="button">Cancel</button>
          </div>
        </form>
        <div class="auth-divider">
          <span>Already have an account?</span>
        </div>
        <button class="btn btn-link" onclick="document.getElementById('close-register-modal').click(); document.getElementById('login-btn').click();" type="button">
          Sign in instead
        </button>
      </div>
    </div>
  </div>

  <div class="modal" id="history-modal" hidden>
    <div class="modal-content large">
      <div class="modal-header">
        <h2>Search History</h2>
        <button class="close-btn" id="close-history-modal" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <div class="history-controls">
          <button class="btn" id="clear-history-btn" type="button">Clear All</button>
        </div>
        <div id="history-list" class="history-list">
          <div class="loading">Loading history...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="close-history-modal-2" type="button">Close</button>
      </div>
    </div>
  </div>

  <!-- Full Chat History Modal -->
  <div class="modal full-history-modal" id="full-history-modal" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h2>Complete Research Conversation</h2>
        <button class="close-btn" id="close-full-history-modal" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <div class="full-history-content">
          <div class="full-history-stats" id="full-history-stats">
            <div class="history-stat">
              <div class="history-stat-number" id="total-messages">0</div>
              <div class="history-stat-label">Messages</div>
            </div>
            <div class="history-stat">
              <div class="history-stat-number" id="total-questions">0</div>
              <div class="history-stat-label">Questions</div>
            </div>
            <div class="history-stat">
              <div class="history-stat-number" id="session-duration">0m</div>
              <div class="history-stat-label">Session Time</div>
            </div>
          </div>
          <div id="full-history-content" class="chat-history">
            <div class="empty-state">No conversation history available</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="export-full-history-btn" type="button">Export Conversation</button>
        <button class="btn btn-primary" id="close-full-history-modal-2" type="button">Close</button>
      </div>
    </div>
  </div>

  <!-- Starfield animation -->
  <script>
    (function(){
      const canvas = document.getElementById('starfield');
      const ctx = canvas.getContext('2d');
      let w=0,h=0,dpr=1;
      const STAR_COUNT = 400;
      const stars = [];
      const shootingStars = [];

      function resize(){
        dpr = window.devicePixelRatio || 1;
        w = Math.max(300, Math.floor(window.innerWidth));
        h = Math.max(200, Math.floor(window.innerHeight));
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }

      function initStars(){
        stars.length = 0;
        for(let i=0;i<STAR_COUNT;i++){
          stars.push({
            x: Math.random() * w,
            y: Math.random() * h,
            r: Math.random() * 1.4 + 0.2,
            alpha: Math.random() * 0.9 + 0.1
          });
        }
      }

      function spawnShootingStar(){
        const fromLeft = Math.random() < 0.5;
        shootingStars.push({
          x: fromLeft ? -50 : w + 50,
          y: Math.random() * h * 0.5,
          vx: (Math.random() * 6 + 6) * (fromLeft ? 1 : -1),
          vy: Math.random() * 2 + 1.5,
          life: 0,
          ttl: Math.floor(Math.random() * 60 + 60),
          trail: []
        });
      }

      function updateShooting(){
        for(let i = shootingStars.length - 1; i >= 0; i--){
          const s = shootingStars[i];
          s.x += s.vx;
          s.y += s.vy;
          s.life++;
          s.trail.push({x: s.x, y: s.y});
          if(s.trail.length > 25) s.trail.shift();
          if(s.life > s.ttl || s.x < -200 || s.x > w + 200 || s.y > h + 200){
            shootingStars.splice(i,1);
          }
        }
      }

      function draw(){
        ctx.fillStyle = '#000';
        ctx.fillRect(0,0,w,h);
        for(let i=0;i<stars.length;i++){
          const s = stars[i];
          ctx.globalAlpha = s.alpha;
          ctx.fillStyle = '#fff';
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
        for(let i=0;i<shootingStars.length;i++){
          const s = shootingStars[i];
          for(let t=0;t<s.trail.length;t++){
            const p = s.trail[t];
            const alpha = (t / s.trail.length) * 0.9 * (1 - s.life / s.ttl);
            ctx.globalAlpha = Math.max(0, alpha);
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(p.x, p.y, Math.max(0, 1 + (1 - t / s.trail.length) * 2), 0, Math.PI*2);
            ctx.fill();
          }
          ctx.globalCompositeOperation = 'lighter';
          ctx.globalAlpha = Math.max(0, 1 - s.life / s.ttl);
          ctx.fillStyle = '#fff';
          ctx.beginPath();
          ctx.arc(s.x, s.y, 2.8, 0, Math.PI*2);
          ctx.fill();
          ctx.globalCompositeOperation = 'source-over';
          ctx.globalAlpha = 1;
        }
      }

      function loop(){
        if (Math.random() < 0.008) spawnShootingStar();
        updateShooting();
        draw();
        requestAnimationFrame(loop);
      }

      resize();
      initStars();
      for(let i=0;i<2;i++) setTimeout(spawnShootingStar, i * 600);
      loop();
      window.addEventListener('resize', ()=>{ resize(); initStars(); });
    })();
  </script>

  <script src="home.js"></script>
</body>
</html>
