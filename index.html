<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SuperNova - NASA Space Biology Knowledge Engine</title>
  <link rel="stylesheet" href="interface.css">
</head>
<body>
  <canvas id="starfield"></canvas>

  <nav>
    <div class="nav-brand">
      <div class="logo-icon 1"> <img src="logo.png" alt="logo" class="adam"></div>
      <h1>SuperNova</h1>
    </div>
    <div class="nav-buttons" id="nav-buttons">
      <button class="btn btn-secondary" onclick="openModal('login')">Login</button>
      <button class="btn btn-primary" onclick="openModal('signup')">Get Started</button>
    </div>
    <div class="user-info" id="user-info" style="display: none;">
      <span id="username-display"></span>
      <button class="btn btn-primary" onclick="goToApp()">Go to App</button>
      <button class="btn btn-secondary" onclick="handleLogout()">Logout</button>
    </div>
  </nav>

  <section class="hero">
    <div class="hero-content">
      <h2>Explore the Universe of NASA Space Biology</h2>
      <p class="hero-subtitle">AI-Powered Research Discovery Platform</p>
      <p class="hero-description">
        Access 608 NASA bioscience publications and 500+ OSDR experiments through 
        intelligent AI agents designed for researchers, students, and space economy professionals.
      </p>
      <div class="cta-buttons">
        <button class="btn btn-primary" onclick="handleGetStarted()">Start Exploring</button>
        <button class="btn btn-secondary" onclick="document.querySelector('.features').scrollIntoView({behavior: 'smooth'})">
          Learn More
        </button>
      </div>
    </div>
  </section>

  <section class="stats">
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-number">608</div>
        <div class="stat-label">NASA Publications</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">500+</div>
        <div class="stat-label">Biology Experiments</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">3</div>
        <div class="stat-label">AI Agent Modes</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">‚àû</div>
        <div class="stat-label">Insights Discovered</div>
      </div>
    </div>
  </section>
  <!-- About Section -->
  <section class="about-section">
    <div class="about-content">
      <h2 class="section-title">About SuperNova</h2>
      <p class="section-subtitle">Your AI-Powered Gateway to NASA Space Biology Research</p>
      
      <div class="about-text">
        <p>SuperNova is an advanced knowledge engine designed to make decades of NASA space biology research accessible and actionable. Built for the NASA Space Apps Challenge 2025, our platform leverages cutting-edge AI technology to help researchers, students, and space economy professionals explore 608 NASA bioscience publications and over 500 OSDR (Open Science Data Repository) experiments.</p>
        
        <p>We believe that space biology research holds the key to humanity's future in space. Whether you're investigating the effects of microgravity on cellular processes, studying radiation impacts on DNA, or exploring sustainable life support systems for long-duration missions, SuperNova provides the intelligence and insights you need.</p>
        
        <div class="about-highlights">
          <div class="highlight-item">
            <span class="highlight-number">608</span>
            <span class="highlight-label">NASA Publications</span>
          </div>
          <div class="highlight-item">
            <span class="highlight-number">500+</span>
            <span class="highlight-label">OSDR Experiments</span>
          </div>
          <div class="highlight-item">
            <span class="highlight-number">3</span>
            <span class="highlight-label">Specialized AI Agents</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- How It Works Section -->
  <section class="how-it-works">
    <h2 class="section-title">How It Works</h2>
    <p class="section-subtitle">Four simple steps to unlock space biology insights</p>
    
    <div class="steps-container">
      <div class="step-card">
        <div class="step-number">1</div>
        <div class="step-icon">üöÄ</div>
        <h3>Choose Your Mode</h3>
        <p>Select from three specialized AI agents: Researcher for deep technical analysis, Student for educational exploration, or Manager for business insights.</p>
      </div>

      <div class="step-card">
        <div class="step-number">2</div>
        <div class="step-icon">üîç</div>
        <h3>Ask Your Question</h3>
        <p>Type your research question in natural language. Our AI understands context and can handle complex, multi-faceted queries about space biology.</p>
      </div>

      <div class="step-card">
        <div class="step-number">3</div>
        <div class="step-icon">üß†</div>
        <h3>Get AI-Powered Insights</h3>
        <p>Receive comprehensive answers backed by peer-reviewed NASA research, complete with citations and relevant experimental data from OSDR.</p>
      </div>

      <div class="step-card">
        <div class="step-number">4</div>
        <div class="step-icon">üìä</div>
        <h3>Explore & Export</h3>
        <p>Dive deeper into source papers, generate quizzes to test understanding, and export findings in multiple formats for your research workflow.</p>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="features">
    <h2 class="section-title">Powerful Research Tools</h2>
    <p class="section-subtitle">Everything you need for space biology research</p>
    
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon">üî¨</div>
        <h3>Researcher Mode</h3>
        <p>Deep dive into technical analysis with access to all 608 publications and 500 OSDR experiments. Get detailed citations and rigorous scientific insights.</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">üìö</div>
        <h3>Student Mode</h3>
        <p>Learn space biology with simplified explanations, analogies, and educational resources. Perfect for students and science enthusiasts.</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">üìä</div>
        <h3>Manager Mode</h3>
        <p>Executive insights combining research data with space economy analysis. Identify investment opportunities and strategic implications.</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">üîç</div>
        <h3>Advanced Filtering</h3>
        <p>Filter by publication year, research topic, and mission context to find exactly what you need.</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">üìÑ</div>
        <h3>Export & Citation</h3>
        <p>Export results in BibTeX, RIS, JSON, or CSV formats. Generate proper citations instantly.</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">üìà</div>
        <h3>Search History</h3>
        <p>Track your research journey with saved searches and restored queries across sessions.</p>
      </div>
    </div>
  </section>

  <!-- Q&A Section -->
  <section class="qa-section">
    <h2 class="section-title">Frequently Asked Questions</h2>
    <p class="section-subtitle">Everything you need to know about SuperNova</p>
    
    <div class="qa-container">
      <div class="qa-item">
        <div class="qa-question">
          <h3>What data sources does SuperNova use?</h3>
          <span class="qa-toggle">+</span>
        </div>
        <div class="qa-answer">
          <p>SuperNova aggregates 608 NASA bioscience publications and over 500 experiments from the NASA Open Science Data Repository (OSDR). Our database includes research on microgravity effects, space radiation biology, plant growth in space, human health adaptations, and more.</p>
        </div>
      </div>

      <div class="qa-item">
        <div class="qa-question">
          <h3>How do the different AI modes work?</h3>
          <span class="qa-toggle">+</span>
        </div>
        <div class="qa-answer">
          <p><strong>Researcher Mode:</strong> Provides technical, citation-heavy responses with detailed methodology and experimental data.<br>
          <strong>Student Mode:</strong> Offers simplified explanations with analogies and educational context, perfect for learning.<br>
          <strong>Manager Mode:</strong> Delivers executive summaries with business implications and investment perspectives on space biology research.</p>
        </div>
      </div>

      <div class="qa-item">
        <div class="qa-question">
          <h3>Can I export my research findings?</h3>
          <span class="qa-toggle">+</span>
        </div>
        <div class="qa-answer">
          <p>Yes! SuperNova supports multiple export formats including BibTeX for LaTeX documents, RIS for reference managers like Mendeley and Zotero, JSON for data analysis, and CSV for spreadsheet applications. You can also copy citations in APA format.</p>
        </div>
      </div>

      <div class="qa-item">
        <div class="qa-question">
          <h3>Is SuperNova free to use?</h3>
          <span class="qa-toggle">+</span>
        </div>
        <div class="qa-answer">
          <p>SuperNova was created for the NASA Space Apps Challenge 2025 as an open educational platform. Access to NASA publications and OSDR data is free. You'll need to create a free account to save your search history and access personalized features.</p>
        </div>
      </div>

      <div class="qa-item">
        <div class="qa-question">
          <h3>How accurate are the AI responses?</h3>
          <span class="qa-toggle">+</span>
        </div>
        <div class="qa-answer">
          <p>All responses are grounded in peer-reviewed NASA research and OSDR experimental data. Our AI agents cite specific publications and experiments. However, always verify critical information with original sources, which we provide with every response.</p>
        </div>
      </div>

      <div class="qa-item">
        <div class="qa-question">
          <h3>Can I use SuperNova for academic research?</h3>
          <span class="qa-toggle">+</span>
        </div>
        <div class="qa-answer">
          <p>Absolutely! SuperNova is designed to support academic research. We provide proper citations for all referenced papers and experiments. Many researchers use SuperNova for literature review, hypothesis generation, and finding relevant NASA studies for their work.</p>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <p>SuperNova Squad ‚Ä¢ NASA Space Apps Challenge 2025</p>
    <p style="margin-top: 0.5rem; font-size: 0.9rem;">
      Exploring the final frontier of space biology research
    </p>
  </footer>

  <div class="modal" id="loginModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Welcome Back</h2>
        <p>Sign in to continue your research</p>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="loginUsername" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="loginPassword" required>
        </div>
        <div class="error-message" id="loginError"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('login')" style="flex: 1">Cancel</button>
          <button type="submit" class="btn btn-primary" style="flex: 1">Login</button>
        </div>
      </form>
      <p style="text-align: center; margin-top: 1rem; color: var(--text-muted);">
        Don't have an account? <a href="#" onclick="openModal('signup'); closeModal('login'); return false;" style="color: var(--accent-primary);">Sign up</a>
      </p>
    </div>
  </div>

  <div class="modal" id="signupModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Join SuperNova</h2>
        <p>Start exploring space biology research</p>
      </div>
      <form id="signupForm">
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="signupUsername" required>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="signupEmail" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="signupPassword" minlength="8" required>
        </div>
        <div class="form-group">
          <label>Confirm Password</label>
          <input type="password" id="signupConfirmPassword" required>
        </div>
        <div class="error-message" id="signupError"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('signup')" style="flex: 1">Cancel</button>
          <button type="submit" class="btn btn-primary" style="flex: 1">Sign Up</button>
        </div>
      </form>
      <p style="text-align: center; margin-top: 1rem; color: var(--text-muted);">
        Already have an account? <a href="#" onclick="openModal('login'); closeModal('signup'); return false;" style="color: var(--accent-primary);">Login</a>
      </p>
    </div>
  </div>

<script>
/* Combined script: starfield animation, auth, modals, forms, FAQ accordion.
   Paste this as a single block just before </body>. */

(function () {
  /* ----------------------
     Starfield / Solar system
     ---------------------- */
  const canvas = document.getElementById('starfield');
  if (canvas) {
    const ctx = canvas.getContext('2d');
    let w = window.innerWidth;
    let h = window.innerHeight;
    let centerX = w / 2;
    let centerY = h / 2;
    const stars = [];
    let time = 0;

    const planets = [
      { distance: 80, size: 4, speed: 0.02, color: '#a8a8a8', name: 'Mercury' },
      { distance: 120, size: 7, speed: 0.015, color: '#e8c48c', name: 'Venus' },
      { distance: 170, size: 8, speed: 0.01, color: '#4a90e2', name: 'Earth', hasMoon: true },
      { distance: 220, size: 6, speed: 0.008, color: '#cd5c5c', name: 'Mars' },
      { distance: 320, size: 16, speed: 0.004, color: '#daa520', name: 'Jupiter' },
      { distance: 400, size: 14, speed: 0.003, color: '#f4e7c3', name: 'Saturn', hasRing: true },
      { distance: 480, size: 11, speed: 0.002, color: '#4fd8eb', name: 'Uranus' },
      { distance: 540, size: 10, speed: 0.0015, color: '#4169e1', name: 'Neptune' }
    ];

    function resizeCanvas() {
      w = window.innerWidth;
      h = window.innerHeight;
      canvas.width = w;
      canvas.height = h;
      centerX = w / 2;
      centerY = h / 2;
    }

    function initStars() {
      stars.length = 0;
      for (let i = 0; i < 300; i++) {
        stars.push({
          x: Math.random() * w,
          y: Math.random() * h,
          r: Math.random() * 1.2 + 0.3,
          alpha: Math.random() * 0.7 + 0.3,
          twinkle: Math.random() * 0.02 + 0.01
        });
      }
    }

    function lightenColor(color, percent) {
      const num = parseInt(color.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = Math.min(255, (num >> 16) + amt);
      const G = Math.min(255, (num >> 8 & 0x00FF) + amt);
      const B = Math.min(255, (num & 0x0000FF) + amt);
      return '#' + (0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1);
    }

    function drawSun() {
      const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 40);
      gradient.addColorStop(0, 'rgba(255, 220, 100, 0.8)');
      gradient.addColorStop(0.4, 'rgba(255, 180, 50, 0.4)');
      gradient.addColorStop(0.7, 'rgba(255, 140, 30, 0.2)');
      gradient.addColorStop(1, 'rgba(255, 100, 0, 0)');

      ctx.globalAlpha = 0.6;
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(centerX, centerY, 40, 0, Math.PI * 2);
      ctx.fill();

      ctx.globalAlpha = 1;
      const coreGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 20);
      coreGradient.addColorStop(0, '#fff5e6');
      coreGradient.addColorStop(0.5, '#ffd966');
      coreGradient.addColorStop(1, '#ffb84d');
      ctx.fillStyle = coreGradient;
      ctx.beginPath();
      ctx.arc(centerX, centerY, 20, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawOrbit(radius) {
      ctx.globalAlpha = 0.1;
      ctx.strokeStyle = '#94a3b8';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      ctx.stroke();
    }

    function drawPlanet(planet, angle) {
      const x = centerX + Math.cos(angle) * planet.distance;
      const y = centerY + Math.sin(angle) * planet.distance;

      ctx.globalAlpha = 0.3;
      const glowGradient = ctx.createRadialGradient(x, y, 0, x, y, planet.size * 1.5);
      glowGradient.addColorStop(0, planet.color);
      glowGradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
      ctx.fillStyle = glowGradient;
      ctx.beginPath();
      ctx.arc(x, y, planet.size * 1.5, 0, Math.PI * 2);
      ctx.fill();

      ctx.globalAlpha = 1;
      const planetGradient = ctx.createRadialGradient(x - planet.size * 0.3, y - planet.size * 0.3, 0, x, y, planet.size);
      planetGradient.addColorStop(0, lightenColor(planet.color, 40));
      planetGradient.addColorStop(1, planet.color);
      ctx.fillStyle = planetGradient;
      ctx.beginPath();
      ctx.arc(x, y, planet.size, 0, Math.PI * 2);
      ctx.fill();

      if (planet.hasRing) {
        ctx.globalAlpha = 0.6;
        ctx.strokeStyle = '#e8d7b0';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.ellipse(x, y, planet.size * 1.8, planet.size * 0.4, Math.PI * 0.2, 0, Math.PI * 2);
        ctx.stroke();
      }

      if (planet.hasMoon) {
        const moonAngle = time * 0.05;
        const moonX = x + Math.cos(moonAngle) * (planet.size * 2.5);
        const moonY = y + Math.sin(moonAngle) * (planet.size * 2.5);
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#d3d3d3';
        ctx.beginPath();
        ctx.arc(moonX, moonY, planet.size * 0.3, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function draw() {
      ctx.fillStyle = '#0a0e1a';
      ctx.fillRect(0, 0, w, h);

      stars.forEach(s => {
        s.alpha += s.twinkle * Math.sin(time * 0.1 + s.x);
        s.alpha = Math.max(0.3, Math.min(1, s.alpha));
        ctx.globalAlpha = s.alpha;
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
      });

      ctx.globalAlpha = 1;
      drawSun();

      planets.forEach(planet => {
        drawOrbit(planet.distance);
        const angle = time * planet.speed;
        drawPlanet(planet, angle);
      });

      time += 1;
    }

    function loop() {
      draw();
      requestAnimationFrame(loop);
    }

    // Initialize canvas animation
    resizeCanvas();
    initStars();
    loop();
    window.addEventListener('resize', () => {
      resizeCanvas();
      initStars();
    });
  } // end canvas block

  /* ----------------------
     Modal handling + helpers
     ---------------------- */
  function openModal(type) {
    const modal = type === 'login' ? document.getElementById('loginModal') : document.getElementById('signupModal');
    if (modal) modal.classList.add('active');
  }

  function closeModal(type) {
    const modal = type === 'login' ? document.getElementById('loginModal') : document.getElementById('signupModal');
    if (modal) modal.classList.remove('active');

    if (type === 'login') {
      const f = document.getElementById('loginForm');
      if (f) f.reset();
      const err = document.getElementById('loginError');
      if (err) err.classList.remove('show');
    } else {
      const f = document.getElementById('signupForm');
      if (f) f.reset();
      const err = document.getElementById('signupError');
      if (err) err.classList.remove('show');
    }
  }

  document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        const id = modal.id === 'loginModal' ? 'login' : 'signup';
        closeModal(id);
      }
    });
  });

  function showError(elementId, message) {
    const errorEl = document.getElementById(elementId);
    if (!errorEl) return;
    errorEl.textContent = message;
    errorEl.classList.add('show');
  }

  /* ----------------------
     Auth: check/store in localStorage
     ---------------------- */
  function checkAuthStatus() {
    const currentUser = localStorage.getItem('supernova_current_user');
    if (currentUser) {
      try {
        const user = JSON.parse(currentUser);
        updateUIForLoggedInUser(user);
        return true;
      } catch (e) {
        localStorage.removeItem('supernova_current_user');
      }
    }
    updateUIForLoggedOutUser();
    return false;
  }

  function updateUIForLoggedInUser(user) {
    const navButtons = document.getElementById('nav-buttons');
    const userInfo = document.getElementById('user-info');
    const usernameDisplay = document.getElementById('username-display');

    if (navButtons) navButtons.style.display = 'none';
    if (userInfo) userInfo.style.display = 'flex';
    if (usernameDisplay) usernameDisplay.textContent = user.username || '';
  }

  function updateUIForLoggedOutUser() {
    const navButtons = document.getElementById('nav-buttons');
    const userInfo = document.getElementById('user-info');
    const usernameDisplay = document.getElementById('username-display');

    if (navButtons) navButtons.style.display = 'flex';
    if (userInfo) userInfo.style.display = 'none';
    if (usernameDisplay) usernameDisplay.textContent = '';
  }

  function goToApp() {
    window.location.href = 'interface.html';
  }

  function handleLogout() {
    localStorage.removeItem('supernova_current_user');
    updateUIForLoggedOutUser();
  }

  function handleGetStarted() {
    if (checkAuthStatus()) {
      goToApp();
    } else {
      openModal('signup');
    }
  }

  // expose some functions globally so inline onclick attributes still work
  window.openModal = openModal;
  window.closeModal = closeModal;
  window.goToApp = goToApp;
  window.handleLogout = handleLogout;
  window.handleGetStarted = handleGetStarted;

  /* ----------------------
     Forms: login & signup
     ---------------------- */
  // Login
  (function attachLoginHandler() {
    const loginForm = document.getElementById('loginForm');
    if (!loginForm) return;

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = (document.getElementById('loginUsername') || {}).value || '';
      const password = (document.getElementById('loginPassword') || {}).value || '';

      if (!username.trim() || !password) {
        showError('loginError', 'Please enter username and password');
        return;
      }

      const users = JSON.parse(localStorage.getItem('supernova_users') || '[]');
      const user = users.find(u => u.username.toLowerCase() === username.trim().toLowerCase());

      if (!user) {
        showError('loginError', 'User not found');
        return;
      }

      if (user.password !== password) {
        showError('loginError', 'Invalid password');
        return;
      }

      localStorage.setItem('supernova_current_user', JSON.stringify({
        id: user.id,
        username: user.username,
        email: user.email
      }));

      closeModal('login');
      updateUIForLoggedInUser({ username: user.username });

      // Redirect to app (short timeout to allow UI update)
      setTimeout(() => { window.location.href = 'interface.html'; }, 300);
    });
  })();

  // Signup
  (function attachSignupHandler() {
    const signupForm = document.getElementById('signupForm');
    if (!signupForm) return;

    signupForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = (document.getElementById('signupUsername') || {}).value || '';
      const email = (document.getElementById('signupEmail') || {}).value || '';
      const password = (document.getElementById('signupPassword') || {}).value || '';
      const confirmPassword = (document.getElementById('signupConfirmPassword') || {}).value || '';

      if (password !== confirmPassword) {
        showError('signupError', 'Passwords do not match');
        return;
      }

      if (password.length < 8) {
        showError('signupError', 'Password must be at least 8 characters');
        return;
      }

      const users = JSON.parse(localStorage.getItem('supernova_users') || '[]');

      if (users.some(u => u.username.toLowerCase() === username.trim().toLowerCase())) {
        showError('signupError', 'Username already taken');
        return;
      }

      if (users.some(u => u.email && u.email.toLowerCase() === email.trim().toLowerCase())) {
        showError('signupError', 'Email already registered');
        return;
      }

      const newUser = {
        id: 'user_' + Date.now(),
        username: username.trim(),
        email: email.trim(),
        password,
        createdAt: new Date().toISOString()
      };

      users.push(newUser);
      localStorage.setItem('supernova_users', JSON.stringify(users));
      localStorage.setItem('supernova_current_user', JSON.stringify({
        id: newUser.id,
        username: newUser.username,
        email: newUser.email
      }));

      closeModal('signup');
      updateUIForLoggedInUser({ username: newUser.username });

      setTimeout(() => { window.location.href = 'interface.html'; }, 300);
    });
  })();

  /* ----------------------
     Accessible FAQ Accordion
     ---------------------- */
  (function initFAQAccordion() {
    const items = document.querySelectorAll('.qa-item');
    if (!items || !items.length) return;

    items.forEach(item => {
      const question = item.querySelector('.qa-question');
      const answer = item.querySelector('.qa-answer');
      if (!question || !answer) return;

      question.setAttribute('role', 'button');
      question.setAttribute('tabindex', '0');
      question.setAttribute('aria-expanded', 'false');

      const answerId = 'qa-answer-' + Math.random().toString(36).slice(2, 9);
      answer.setAttribute('id', answerId);
      question.setAttribute('aria-controls', answerId);

      // If item already has .active in markup, ensure aria and maxHeight are set
      if (item.classList.contains('active')) {
        question.setAttribute('aria-expanded', 'true');
        answer.style.maxHeight = answer.scrollHeight + 'px';
      } else {
        answer.style.maxHeight = null;
      }

      function toggle(ev) {
        if (ev && ev.type === 'keydown' && ev.key !== 'Enter' && ev.key !== ' ' && ev.key !== 'Spacebar') return;
        if (ev) ev.preventDefault();

        const opening = !item.classList.contains('active');

        if (opening) {
          // If you want only one open at a time, uncomment the following:
          // items.forEach(other => { if (other !== item) { other.classList.remove('active'); const a = other.querySelector('.qa-answer'); if (a) a.style.maxHeight = null; const q = other.querySelector('.qa-question'); if (q) q.setAttribute('aria-expanded', 'false'); } });

          item.classList.add('active');
          question.setAttribute('aria-expanded', 'true');
          // Set inline max-height for smooth transition
          answer.style.maxHeight = answer.scrollHeight + 'px';
        } else {
          item.classList.remove('active');
          question.setAttribute('aria-expanded', 'false');
          // Remove max-height to allow CSS to collapse
          answer.style.maxHeight = null;
        }
      }

      question.addEventListener('click', toggle);
      question.addEventListener('keydown', toggle);
    });

    // Ensure any active items have their height set after fonts/images load
    window.addEventListener('load', () => {
      document.querySelectorAll('.qa-item.active .qa-answer').forEach(a => {
        a.style.maxHeight = a.scrollHeight + 'px';
      });
    });
  })();

  /* ----------------------
     Init on DOM ready
     ---------------------- */
  document.addEventListener('DOMContentLoaded', () => {
    // initial auth UI update
    checkAuthStatus();
    // attach logout button if present (defensive)
    const logoutBtn = document.querySelector('[onclick="handleLogout()"]');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', (ev) => {
        ev.preventDefault();
        handleLogout();
      });
    }
  });

})();
</script>
</body>
</html>